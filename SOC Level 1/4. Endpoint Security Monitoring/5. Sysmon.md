# 🛡️ Sysmon Overview for SOC Analysts

## What is Sysmon?
**Sysmon** (System Monitor) is a Windows system service and device driver that logs detailed system activity to the Windows Event Log. It's essential for endpoint detection and response (EDR) and SIEM pipelines.

- **Logs stored at**: `Applications and Services Logs > Microsoft > Windows > Sysmon > Operational`
- **Config required**: XML-based file defining rules (include/exclude logic)
- **Used with**: SIEMs, WEC (Windows Event Collection), and threat-hunting tools

## 📄 Configuration Philosophy
- **SwiftOnSecurity**: Exclude-based → reduce noise
- **ION-Storm**: Include-based → catch more signals
- **Pro Tip**: Tailor the config based on your network baseline and use cases.

## 🔍 Commonly Used Sysmon Event IDs

### 🧠 Event ID 1 – Process Creation
Logs every new process along with:
- `CommandLine`
- `Image`

#### Sample Config
```xml
<ProcessCreate onmatch="exclude">
  <CommandLine condition="is">C:\Windows\System32\svchost.exe -k appmodel</CommandLine>
</ProcessCreate>
```

### 🌐 Event ID 3 – Network Connection

Captures outbound connections made by processes:
- `Image`
- `DestinationPort`

#### Sample Config
```xml
<NetworkConnect onmatch="include">   <Image condition="image">nmap.exe</Image>   <DestinationPort condition="is">4444</DestinationPort> </NetworkConnect>
```

### 🧬 Event ID 7 – Image Load

Monitors DLLs loaded by processes (use with caution due to high noise):

- `ImageLoaded`
- `Signed`
- `Signature`
    
#### Sample Config
```xml
<ImageLoad onmatch="include">   <ImageLoaded condition="contains">\Temp\</ImageLoaded> </ImageLoad>
```

### 🧩 Event ID 8 – CreateRemoteThread

Detects code injection between processes:

- `SourceImage`
- `TargetImage`
- `StartAddress`
    
#### Sample Config
```xml
<CreateRemoteThread onmatch="include">   <StartAddress condition="end with">0B80</StartAddress> </CreateRemoteThread>
```

### 📁 Event ID 11 – File Create

Logs file creation on disk:
- `TargetFilename`
    
#### Sample Config
```xml
<FileCreate onmatch="include">   <TargetFilename condition="contains">HELP_TO_SAVE_FILES</TargetFilename> </FileCreate>
```

### 🧠 Event ID 12 / 13 / 14 – Registry Events

Monitors registry writes (useful for persistence):
- `TargetObject`
    
#### Sample Config
```xml
<RegistryEvent onmatch="include">   <TargetObject condition="contains">Windows\System\Scripts</TargetObject> </RegistryEvent>
```


### 💾 Event ID 15 – Alternate Data Streams (ADS)

Logs file creation in alternate data streams (e.g., hidden malware):

- `TargetFilename`
    
#### Sample Config
```xml
<FileCreateStreamHash onmatch="include">   <TargetFilename condition="end with">.hta</TargetFilename> </FileCreateStreamHash>
```

### 📡 Event ID 22 – DNS Query

Logs all DNS queries (common in malware beaconing):

- `QueryName`
    

#### Sample Config
```xml
<DnsQuery onmatch="exclude">   <QueryName condition="end with">.microsoft.com</QueryName> </DnsQuery>
```

## 🧰 Useful Sysmon Config Repositories

- [SwiftOnSecurity Sysmon Config](https://github.com/SwiftOnSecurity/sysmon-config)
- [ION-Storm Fork (Aggressive detection)](https://github.com/ion-storm/sysmon-config)
    
## 🧭 Analyst Tips

- Deploy Sysmon with a config at scale using GPO or deployment tools.
- Integrate Sysmon logs into a SIEM for threat detection rules.
- Tailor rules: Exclude noise (e.g., system files), include high-signal behaviors (e.g., PowerShell + encoded commands).
- Hunt by combining:
    - EID 1 + CommandLine anomalies
    - EID 3 + uncommon destinations
    - EID 22 + strange domain patterns
        




