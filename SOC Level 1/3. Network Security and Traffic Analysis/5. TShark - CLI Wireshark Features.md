# ğŸ“Š Command-Line Wireshark Features I â€“ Statistics with TShark

TShark is the CLI equivalent of Wireshark and supports many of its analysis features â€” including **statistics**, **colorized output**, and **protocol analysis**.

- âœ… These features apply to **all packets** unless a `-Y <display filter>` is specified.

## ğŸ¨ `--color`

Enables **colorized output** similar to Wiresharkâ€™s GUI.

```bash
tshark --color
```

## ğŸ“ˆ `-z` Statistics Option

The `-z` parameter is used to extract **statistical data** from the capture.

### ğŸ“– View All Available Statistics Options:

```bash
tshark -z help
```

This command lists all statistical reporting modules, like protocol hierarchy, flow graphs, endpoints, conversations, etc.

## ğŸ“Œ Sample Usage

### View Protocol Hierarchy Statistics (equivalent to Wireshark's _Statistics > Protocol Hierarchy_):

```bash
tshark -r file.pcap -z io,phs
```

## ğŸ¨ Colourised Output

TShark can provide **colourised outputs** to help analysts:

- Speed up visual packet analysis
- Quickly spot anomalies
- Mimic the familiar **Wireshark-style packet highlighting**

```bash
user@ubuntu$ tshark -r colour.pcap --color
```
![[Pasted image 20250611110217.png]]

## ğŸ“Š TShark Statistics: Protocol Hierarchy

The **Protocol Hierarchy** feature helps analysts quickly understand:

- Protocols observed in the capture
- Total packet count per protocol
- Total byte size per protocol
- A tree-structured breakdown of protocol layers


### ğŸ” Why Use Protocol Hierarchy?

- Gives a **summary overview** of the capture
- Helps identify **dominant protocols**
- Allows analysts to **focus** on suspicious or interesting protocol layers

Use theÂ `-z io,phs -q`Â parameters to view the protocol hierarchy.
![[Pasted image 20250611110616.png]]

After viewing the entire packet tree, you can focus on a specific protocol as shown below. Add theÂ `udp`Â keyword to the filter to focus on theÂ UDPÂ protocol.
![[Pasted image 20250611110656.png]]

## ğŸ“ TShark Statistics: Packet Lengths Tree

The **Packet Lengths Tree** provides a visual breakdown of the **distribution of packet sizes** in a capture. This helps identify:

- Unusually large packets
- Very small packets
- Distribution clusters (e.g., many packets in a certain size range)

### ğŸ” Why Use Packet Length Tree?

- Detect **abnormal traffic patterns**
- Quickly identify **oversized** or **tiny packets**
- Understand **overall packet size distribution**

![[Pasted image 20250611110848.png]]

## ğŸŒ TShark Statistics: Endpoints

The **Endpoints view** provides a list of all **unique communication endpoints** (IP, MAC, TCP, UDP, etc.) involved in a capture, along with:

- Number of packets sent/received
- Number of bytes
- Endpoint address type (IPv4, IPv6, MAC, etc.)

### ğŸ› ï¸ Command Syntax

```bash
tshark -r <file>.pcap -z endpoints,<type> -q
```

For live capture:
```bash
tshark -i <interface> -z endpoints,<type> -q
```

- `-z endpoints,<type>`: Generate statistics for specified endpoint type
- `-q`: Suppress packet details

### ğŸ“˜ Example


```bash
tshark -r capture.pcap -z endpoints,ip -q
```

This will output a table of all **IPv4 endpoints** showing:

- IP address
- Packet count
- Bytes sent/received

### ğŸ§° Supported Filters

|Filter|Description|
|---|---|
|`eth`|Ethernet (MAC) addresses|
|`ip`|IPv4 addresses|
|`ipv6`|IPv6 addresses|
|`tcp`|TCP endpoints (IPv4 & IPv6 supported)|
|`udp`|UDP endpoints (IPv4 & IPv6 supported)|
|`wlan`|IEEE 802.11 (Wi-Fi MAC addresses)|
![[Pasted image 20250611111448.png]]

## ğŸ” TShark Statistics: Conversations

The **Conversations view** shows communication between two endpoints as **pairs**, offering a high-level overview of:

- Traffic **direction**
- **Number of packets** and **bytes** exchanged
- Initiator and responder roles


### ğŸ› ï¸ Command Syntax

```bash
tshark -r <file>.pcap -z conv,<type> -q
```

For live capture:
```bash
tshark -i <interface> -z conv,<type> -q
```

- `-z conv,<type>`: Show conversation statistics by type
- `-q`: Quiet mode (suppress detailed packet output)

### ğŸ“˜ Example
![[Pasted image 20250611112048.png]]

This displays all IP-based two-way conversations with:

- Source IP â†” Destination IP
- Packet count (in both directions)
- Bytes transferred

### ğŸ§° Supported Filters

|Filter|Description|
|---|---|
|`eth`|Ethernet (MAC) conversations|
|`ip`|IPv4 conversations|
|`ipv6`|IPv6 conversations|
|`tcp`|TCP session-level conversations|
|`udp`|UDP conversations|
|`wlan`|IEEE 802.11 (Wi-Fi) conversations|
## ğŸ§  TShark Statistics: Expert Info

The **Expert Info** view in TShark provides **diagnostic messages and protocol anomalies**, similar to Wiresharkâ€™s **Expert Information tab**. It helps analysts identify:

- Protocol violations
- Malformed packets
- Unusual traffic patterns
- Potential errors and warnings

### ğŸ› ï¸ Command Syntax

```bash
tshark -r <file>.pcap -z expert -q

# For live capture:
tshark -i <interface> -z expert -q
```
 
- `-z expert`: Displays expert-level comments/statistics
- `-q`: Suppresses packet-by-packet output, showing only expert data

![[Pasted image 20250611112836.png]]

## ğŸ•µï¸ Story: _The Curious Case of the Lagging Server_

### Scene 1: The Incident

Raj, a junior cybersecurity analyst, received an urgent call from the DevOps team:

> â€œOur main application server is **lagging heavily** and **users are complaining of timeouts**! Can you check if itâ€™s a **network issue**?â€

Raj doesnâ€™t have a GUI. He only has SSH access to the serverâ€”and that's where **TShark** becomes his superhero tool.

### Scene 2: Starting with a Simple Sniff

Raj launches a capture using:

bash

CopyEdit

`tshark -i eth0 --color`

The `--color` flag helps highlight packets like Wireshark does, making it easier to spot anomalies while reading terminal output.

### Scene 3: Let the Stats Begin

To avoid drowning in thousands of lines, Raj decides to use **statistical tools** that TShark offers.

#### ğŸ§± Step 1: Protocol Hierarchy (`-z io,phs -q`)

```bash
tshark -i eth0 -z io,phs -q
```

This command **shows the hierarchy of all protocols** in the capture. He notices:

- **50% is HTTP**
- **25% is DNS**
- **Surprisingly, a lot of ARP traffic**!
    
This tells Raj that a **ton of name resolution** and **network-level chatter** is happening. Somethingâ€™s weird here...

#### ğŸ“¦ Step 2: Packet Length Tree (`-z plen,tree -q`)

He wants to know **what size packets are most common**:

```bash
tshark -i eth0 -z plen,tree -q
```

This reveals a lot of **tiny packets (60-80 bytes)** and **a few very large ones (~1500 bytes)**, hinting at possibly **a flood of small requests**.

#### ğŸŒ Step 3: IP Endpoints (`-z endpoints,ip -q`)

To spot which IPs are **talking the most**, Raj uses:

```bash
tshark -i eth0 -z endpoints,ip -q
```

Boom ğŸ’¥ â€” a **single IP** appears with **10x the number of packets** compared to others. Possibly the culprit.

#### ğŸ” Step 4: Conversations (`-z conv,ip -q`)

To see **which devices are having intense back-and-forth**, he runs:

```bash
tshark -i eth0 -z conv,ip -q
```

This helps him discover a **flood of requests** between the same two IPs (maybe a loop, or abuse).

#### âš ï¸ Step 5: Expert Info (`-z expert -q`)

Finally, he wants to know what TShark thinks about all of this:

```bash
tshark -i eth0 -z expert -q
```

This shows:

- â€œ**Duplicate ACKs**â€
- â€œ**TCP Retransmissions**â€
- â€œ**Malformed DNS queries**â€
    
Thatâ€™s the **smoking gun**. The network is overloaded with **faulty DNS requests** and **TCP issues**.


### ğŸ§© Conclusion: Case Solved

Raj shares the output with the team and confirms:

> â€œLooks like a misconfigured internal script is **spamming the DNS server** and causing **network congestion**.â€

This is how he solved the case

### ğŸ“˜ Recap Summary of TShark Features Raj Used

|Feature|Command|Why Raj Used It|
|---|---|---|
|**Color output**|`--color`|Makes real-time sniffing more readable|
|**Protocol hierarchy**|`-z io,phs -q`|Understand which protocols dominate|
|**Packet length tree**|`-z plen,tree -q`|Spot abnormal packet sizes|
|**Endpoints view**|`-z endpoints,ip -q`|Find IPs sending/receiving most traffic|
|**Conversations view**|`-z conv,ip -q`|Discover whoâ€™s talking to whom and how much|
|**Expert info**|`-z expert -q`|Automatically catch anomalies|
### ğŸ§  Tip

After reading your notes, re-read this story and **imagine yourself as Raj** using TShark step-by-step in a crisis. Itâ€™ll help reinforce each flag and why itâ€™s used, so youâ€™ll not only _know_ the commandsâ€”youâ€™ll understand _when and why_ to use them.

Let me know if you want a similar story for `capture filters`, `display filters`, or `-a` & `-b` conditions!